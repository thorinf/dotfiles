# Dotfiles

Personal dotfiles managed via a Git bare repo with `$HOME` as the work tree. Curated per‑directory `.gitignore` files keep third‑party plugin code out while tracking configs and small custom scripts.

## Setup

```bash
git clone --bare <repo-url> ~/.dotfiles                  # clone bare repo
alias dotfiles='git --git-dir=$HOME/.dotfiles --work-tree=$HOME'
dotfiles checkout                                        # populate tracked files into $HOME
dotfiles config status.showUntrackedFiles no             # hide home-directory noise
# Optional: use a global excludes file
git config --global core.excludesfile "$HOME/.config/git/ignore"
```

Add the alias to your shell config (e.g., `~/.zshrc`). On first run, zinit and TPM will self‑install if missing (network needed once).

## Usage

```bash
dotfiles status                    # show changes
dotfiles add <path>                # stage a file
dotfiles commit -s -m "msg"        # commit with signoff
dotfiles push                      # push to origin
```

## Tracking Policy

- Plugins: do not vendor third‑party plugin code. Rely on managers to install.
- Locks: track pin files for reproducibility (e.g., `~/.config/nvim/lazy-lock.json`). The backup config’s lockfile is ignored (`~/.config/nvim.backup/lazy-lock.json`).
- Per‑dir ignores: keep generated artifacts out of the repo.
  - `~/.tmux/.gitignore`: ignores `plugins/` (TPM clones).
  - `~/.config/nvim/.gitignore`: ignores `plugin/` and `spell/`.
  - `~/.local/share/.gitignore`: ignores `zinit/` clone.
  - `~/.emacs.d/.gitignore`: ignores `elpa/`, `eln-cache/`, autosaves, and common caches.

If you have your own small Neovim Lua files under `~/.config/nvim/plugin/`, un‑ignore specific files and add them.

## Structure

- `~/.zshrc`: zinit + Powerlevel10k; aliases and completion tweaks.
- `~/.p10k.zsh`: prompt theme (generated by `p10k configure`).
- `~/.config/tmux/tmux.conf`: truecolor, prefix `Ctrl+a`, pane/window binds, OSC 52 copy; TPM.
- `~/.config/ghostty/config`: theme, opacity, split navigation, close surface.
- `~/.config/ruff/ruff.toml`: Python lint/format defaults.
- `~/.config/nvim/**`: lazy.nvim plugin specs, LSP/cmp/treesitter configs, lockfile.
- `~/.config/nvim` (current): NvChad v3 Starter vendored (no submodule). Overrides live in:
  - `lua/chadrc.lua`: theme/UI (tokyonight, transparency)
  - `lua/options.lua`: options + Python host
  - `lua/autocmds.lua`: filetypes (templ)
  - `lua/configs/lspconfig.lua`: LSP overrides (Ruff/BasedPyright, Tailwind, clangd, etc.)
  - `lua/plugins/init.lua`: add/override plugins (if needed)
- `~/.config/nvim.backup` (previous config): original lazy.nvim setup retained for reference.
- `~/.emacs.d/init.el`: minimal Emacs with evil + org.

## Shortcuts

### Ghostty
- cmd+Left/Right/Up/Down: move between splits
- cmd+d / cmd+shift+d: split right / split down
- cmd+w: close surface (tab/window)

### Zsh
- Ctrl+p / Ctrl+n: history search backward/forward
- Alt+w: kill region
- Powerlevel10k theme; zinit manages plugins (syntax, completions, autosuggest)
- Pomodoro alias: requires a macOS Shortcuts shortcut named "Start Pomodoro".
  - The shortcut prompts for minutes interactively; no CLI input is passed.
  - If you renamed the shortcut, update the alias in `~/.zshrc` accordingly.


### TMUX
- Prefix: Ctrl+a (send-prefix on Ctrl+a)
- Panes: h/j/k/l or Alt+Arrow; split: `-`/`|` or `"`/`%`; new window: `c`
- Windows: Shift+Left/Right or Alt+h/Alt+l
- Copy mode (vi): `y` copy selection, `Y` copy to EOL (OSC 52 clipboard)
- Display: truecolor enabled (`tmux-256color` + RGB overrides)

### Neovim
- Leader: Space
- Telescope: `<leader>ff` files, `fb` buffers, `fg` live grep, `fh` help, `fn` file browser
- LSP/completion via mason + cmp; treesitter for syntax; which-key/lualine UI

#### Neovim: Theme & Transparency
- Theme: tokyonight via NvChad base46.
- Transparency: enabled (Normal/NormalNC/NormalFloat/FloatBorder/SignColumn/EndOfBuffer are `NONE`).
- If theme doesn’t change or transparency doesn’t apply:
  - Clear cache: `rm -rf ~/.local/share/nvim/base46` and restart Neovim.
  - Ensure terminal supports transparency (e.g., Ghostty `background-opacity`, iTerm2 window transparency).

#### Neovim: LSP & Python
- Python host: `vim.g.python3_host_prog = ~/.venvs/nvim/bin/python`.
- Ruff LSP: runs from project `.venv` (`python -m ruff server`), formats on save when supported.
- BasedPyright: launched via `uv run basedpyright-langserver --stdio`; analysis `pythonPath` points to project `.venv` if present.
- Tailwind: maps `templ` to `html`.
- templ/jsonls/yamlls/clangd/hls/rust_analyzer/lua_ls configured; clangd uses utf-16 offsets and stricter flags.
- Check with `:LspInfo` inside a buffer.

##### Python provider setup (host venv)
Neovim’s Python provider uses a dedicated venv at `~/.venvs/nvim`:

Using uv (recommended):

```bash
uv venv ~/.venvs/nvim
uv pip install -U pip pynvim
```

Using system Python:

```bash
python3 -m venv ~/.venvs/nvim
~/.venvs/nvim/bin/pip install -U pip pynvim
```

Verify in Neovim:

```vim
:echo g:python3_host_prog
:checkhealth provider
```

Note: This venv is only for Neovim’s Python provider. LSP tools like Ruff/BasedPyright run from your project’s `.venv` and are independent of the host venv.

##### Project venv (Ruff/BasedPyright)
Each project should have its own `.venv` so LSP tools match the project’s dependencies and Python version.

Create and install with uv (recommended):

```bash
cd /path/to/project
uv venv .venv
uv pip install -U ruff basedpyright
```

Using system Python:

```bash
cd /path/to/project
python3 -m venv .venv
. .venv/bin/activate
pip install -U ruff basedpyright
```

Verification:

```bash
.venv/bin/python -m ruff --version
uv run basedpyright-langserver --version  # or .venv/bin/basedpyright-langserver --version
```

In Neovim, open a Python file and run `:LspInfo`—you should see both `ruff` and `basedpyright` attached.

### Emacs
- Focused on Org mode (with evil keybindings); minimal elsewhere
- Org indentation/visual tweaks; evil-org for better navigation

## Notes

- Local‑only ignores: for host‑specific or personal files, use `~/.dotfiles/info/exclude` to ignore without committing patterns.
- Terminfo: `tmux-256color` is preferred; ensure it exists on the host or add a fallback in `tmux.conf`.

## How it Works

A Git bare repository lives at `~/.dotfiles` and treats `$HOME` as the working tree. This tracks selected files without turning your entire home directory into a Git repo.
